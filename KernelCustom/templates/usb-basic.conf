#!/bin/bash
TEMPLATE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

CONFIG="$TEMPLATE_DIR/../sources/linux/scripts/config"

BLUE=$(tput setaf 6); GREEN=$(tput setaf 2); RED=$(tput setaf 1); BOLD=$(tput bold); RESET=$(tput sgr0)

echo "${BLUE}=== [USB-Basic] Activation du support USB minimal ===${RESET}"
$CONFIG --enable CONFIG_USB_SUPPORT && echo "  ${GREEN}+ USB support activé${RESET}"
$CONFIG --enable CONFIG_USB_COMMON && echo "  ${GREEN}+ USB commun activé${RESET}"
$CONFIG --enable CONFIG_USB_XHCI_HCD && echo "  ${GREEN}+ USB 3.0 (XHCI) activé${RESET}"
$CONFIG --enable CONFIG_USB_EHCI_HCD && echo "  ${GREEN}+ USB 2.0 (EHCI) activé${RESET}"
$CONFIG --enable CONFIG_USB_OHCI_HCD && echo "  ${GREEN}+ USB 1.1 (OHCI) activé${RESET}"
$CONFIG --enable CONFIG_USB_HID && echo "  ${GREEN}+ HID USB activé${RESET}"
$CONFIG --enable CONFIG_HID_GENERIC && echo "  ${GREEN}+ HID générique activé${RESET}"
$CONFIG --disable CONFIG_USB_STORAGE && echo "  ${RED}- Stockage USB désactivé${RESET}"
$CONFIG --disable CONFIG_USB_PRINTER && echo "  ${RED}- Imprimantes USB désactivées${RESET}"
$CONFIG --disable CONFIG_USB_SERIAL && echo "  ${RED}- USB série désactivé${RESET}"
echo "✅ ${BOLD}${GREEN}[USB-Basic] Terminé.${RESET}"
$CONFIG --set-str MODULE_SIG_KEY "certs/signing_key.pem"
$CONFIG --enable MODULE_SIG_KEY_TYPE_RSA
$CONFIG --enable SYSTEM_TRUSTED_KEYRING
$CONFIG --set-str SYSTEM_TRUSTED_KEYS ""
