#!/bin/bash
TEMPLATE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

CONFIG="$TEMPLATE_DIR/../sources/linux/scripts/config"

BLUE=$(tput setaf 6); GREEN=$(tput setaf 2); RED=$(tput setaf 1); BOLD=$(tput bold); RESET=$(tput sgr0)

echo "${BLUE}=== [Crypto] Configuration de la signature des modules ===${RESET}"
$CONFIG --enable MODULE_SIG && echo "  ${GREEN}+ Signature des modules activée${RESET}"
$CONFIG --set-str MODULE_SIG_KEY "certs/signing_key.pem" && echo "  ${GREEN}+ Clé de signature : certs/signing_key.pem${RESET}"
$CONFIG --enable MODULE_SIG_KEY_TYPE_RSA && echo "  ${GREEN}+ Type de clé : RSA${RESET}"
$CONFIG --disable SYSTEM_TRUSTED_KEYS && echo "  ${RED}- Clés système de confiance désactivées${RESET}"
$CONFIG --disable SYSTEM_REVOCATION_KEYS && echo "  ${RED}- Clés de révocation système désactivées${RESET}"
$CONFIG --disable SYSTEM_BLACKLIST_KEYRING && echo "  ${RED}- Blacklist de clés désactivée${RESET}"
$CONFIG --disable MODULE_SIG_FORCE && echo "  ${RED}- Signature obligatoire désactivée (modules non signés autorisés)${RESET}"
echo "✅ ${BOLD}${GREEN}[Crypto] Configuration de la signature des modules terminée.${RESET}"
$CONFIG --enable SYSTEM_TRUSTED_KEYRING
