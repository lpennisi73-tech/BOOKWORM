#!/bin/bash
TEMPLATE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

CONFIG="$TEMPLATE_DIR/../sources/linux/scripts/config"

BLUE=$(tput setaf 6); GREEN=$(tput setaf 2); RED=$(tput setaf 1); BOLD=$(tput bold); RESET=$(tput sgr0)

echo "${BLUE}=== [VGA-Fallback] Activation du mode VGA de secours ===${RESET}"
$CONFIG --enable CONFIG_VGA_CONSOLE && echo "  ${GREEN}+ Console VGA activée${RESET}"
$CONFIG --enable CONFIG_VGACON_SOFT_SCROLLBACK && echo "  ${GREEN}+ Scrollback VGA activé${RESET}"
$CONFIG --set-val CONFIG_VGACON_SOFT_SCROLLBACK_SIZE 64 && echo "  ${GREEN}+ Taille scrollback : 64${RESET}"
$CONFIG --enable CONFIG_FB && echo "  ${GREEN}+ Framebuffer activé${RESET}"
$CONFIG --enable CONFIG_FB_VGA16 && echo "  ${GREEN}+ VGA16 activé${RESET}"
$CONFIG --enable CONFIG_FB_SIMPLE && echo "  ${GREEN}+ Framebuffer simple activé${RESET}"
$CONFIG --enable CONFIG_FRAMEBUFFER_CONSOLE && echo "  ${GREEN}+ Console framebuffer activée${RESET}"
$CONFIG --disable CONFIG_FB_CIRRUS && echo "  ${RED}- FB Cirrus désactivé${RESET}"
$CONFIG --disable CONFIG_FB_NVIDIA && echo "  ${RED}- FB NVIDIA désactivé${RESET}"
$CONFIG --disable CONFIG_FB_RADEON && echo "  ${RED}- FB Radeon désactivé${RESET}"
echo "✅ ${BOLD}${GREEN}[VGA-Fallback] Terminé.${RESET}"
$CONFIG --set-str MODULE_SIG_KEY "certs/signing_key.pem"
$CONFIG --enable MODULE_SIG_KEY_TYPE_RSA
$CONFIG --enable SYSTEM_TRUSTED_KEYRING
$CONFIG --set-str SYSTEM_TRUSTED_KEYS ""
